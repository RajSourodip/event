<!DOCTYPE html>
<html>
<head>
    <title>District Reports</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: fixed;
            background-image: url(https://i.pinimg.com/originals/62/39/4d/62394d753859943e6a1a36443ef78795.gif);
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            opacity: 1;
            min-height: 100vh;
            max-height: fit-content;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
            font-size: 2em;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background-image: url(https://i.pinimg.com/originals/62/39/4d/62394d753859943e6a1a36443ef78795.gif);
            color: white;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr {
            background-color: white;
        }
        td {
            color: black;
        }
        h1 {
            color: white;
            font-size: 2.5em;
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            text-align: center;
            margin: auto;
            margin-bottom: 10%;
            width: fit-content;
        }
    
        @media (max-width: 768px) {
            table, thead, tbody, th, td, tr {
                display: block;
            }
            th {
                /* background-color: rgb(37, 45, 192); */
                background-image: url(https://i.pinimg.com/originals/62/39/4d/62394d753859943e6a1a36443ef78795.gif);
                color: white;
                position: sticky;
                top: 0;
            }
            tr {
                display: flex;
                flex-direction: column;
                margin-bottom: 10px;
                border: 1px solid #ddd;
                background-color: white;
            }
            td {
                text-align: left;
                padding-left: 50%;
                position: relative;
            }
            td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                width: 50%;
                padding-left: 10px;
                font-weight: bold;
                text-align: left;
                background-color: #f2f2f2;
                border-right: 1px solid #ddd;
                box-sizing: border-box;
            }
        }
    </style>
</head>
<body>
    <h1>District Reports</h1>
    <table id="reportsTable">
        <thead>
            <tr>
                <th>District</th>
                <th>Schools</th>
                <th>PD (Principal Demo)</th>
                <th>SMD (Senior Management Demo)</th>
                <th>Signed</th>
                <th>SMD (Senior Management Demo) to Sign Up Follow Up</th>
                <th>Hot Follow Up</th>
                <th>NI</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <script>
        // Function to create the table rows and cells
        function createTable(data) {
            const tbody = document.getElementById('reportsTable').getElementsByTagName('tbody')[0];

            const districts = Object.keys(data);
            const totals = {
                schools: 0,
                pd: 0,
                smd: 0,
                signed: 0,
                smdToSignUpFollowUp: 0,
                hotFollowUp: 0,
                ni: 0
            };

            districts.forEach(district => {
                const reports = data[district];
                const districtRow = document.createElement('tr');

                const districtCell = document.createElement('td');
                districtCell.innerText = district;
                districtRow.appendChild(districtCell);

                const stats = {
                    schools: reports.length,
                    pd: 0,
                    smd: 0,
                    signed: 0,
                    smdToSignUpFollowUp: 0,
                    hotFollowUp: 0,
                    ni: 0
                };

                reports.forEach(report => {
                    stats.pd += parseInt(report.pdDone);
                    stats.smd += parseInt(report.smdDone);
                    stats.signed += parseInt(report.signed);
                    stats.smdToSignUpFollowUp +=parseInt( report.signUpFollowUp);
                    stats.hotFollowUp += parseInt(report.tdDone);  // Assuming hot follow-up is related to tdDone
                    stats.ni += parseInt(report.strength);  // Assuming NI is related to strength
                });

                totals.schools += parseInt(stats.schools);
                totals.pd += parseInt(stats.pd);
                console.log(totals.pd);
                
                totals.smd += parseInt(stats.smd);
                totals.signed += parseInt(stats.signed);
                totals.smdToSignUpFollowUp += parseInt(stats.smdToSignUpFollowUp);
                totals.hotFollowUp += parseInt(stats.hotFollowUp);
                totals.ni += parseInt(stats.ni);

                districtRow.innerHTML += `
                    <td>${stats.schools}</td>
                    <td>${stats.pd}</td>
                    <td>${stats.smd}</td>
                    <td>${stats.signed}</td>
                    <td>${stats.smdToSignUpFollowUp}</td>
                    <td>${stats.hotFollowUp}</td>
                    <td>${stats.ni}</td>
                `;

                tbody.appendChild(districtRow);
            });

            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td>Total</td>
                <td>${totals.schools}</td>
                <td>${totals.pd}</td>
                <td>${totals.smd}</td>
                <td>${totals.signed}</td>
                <td>${totals.smdToSignUpFollowUp}</td>
                <td>${totals.hotFollowUp}</td>
                <td>${totals.ni}</td>
            `;
            tbody.appendChild(totalRow);
        }

        // Function to fetch data from the backend
        function fetchData() {
            fetch('/getReportsByDistrict')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        createTable(data.data);
                    } else {
                        console.error('Error fetching data:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                });
        }

        // Fetch data when the page loads
        window.onload = fetchData;
    </script>
</body>
</html>
