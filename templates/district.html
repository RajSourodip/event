<!DOCTYPE html>
<html>
<head>
    <title>District Reports</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>District Reports</h1>
    <table id="reportsTable">
        <thead>
            <tr>
                <th>District</th>
                <th>Schools</th>
                <th>PD</th>
                <th>SMD</th>
                <th>Signed</th>
                <th>SMD to Sign Up Follow Up</th>
                <th>Hot Follow Up</th>
                <th>NI</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    <script>
        // Function to create the table rows and cells
        function createTable(data) {
            const tbody = document.getElementById('reportsTable').getElementsByTagName('tbody')[0];

            const districts = Object.keys(data);
            const totals = {
                schools: 0,
                pd: 0,
                smd: 0,
                signed: 0,
                smdToSignUpFollowUp: 0,
                hotFollowUp: 0,
                ni: 0
            };

            districts.forEach(district => {
                const reports = data[district];
                const districtRow = document.createElement('tr');

                const districtCell = document.createElement('td');
                districtCell.innerText = district;
                districtRow.appendChild(districtCell);

                const stats = {
                    schools: reports.length,
                    pd: 0,
                    smd: 0,
                    signed: 0,
                    smdToSignUpFollowUp: 0,
                    hotFollowUp: 0,
                    ni: 0
                };

                reports.forEach(report => {
                    stats.pd += parseInt(report.pdDone);
                    stats.smd += parseInt(report.smdDone);
                    stats.signed += parseInt(report.signed);
                    stats.smdToSignUpFollowUp +=parseInt( report.signUpFollowUp);
                    stats.hotFollowUp += parseInt(report.tdDone);  // Assuming hot follow-up is related to tdDone
                    stats.ni += parseInt(report.strength);  // Assuming NI is related to strength
                });

                totals.schools += parseInt(stats.schools);
                totals.pd += parseInt(stats.pd);
                console.log(totals.pd);
                
                totals.smd += parseInt(stats.smd);
                totals.signed += parseInt(stats.signed);
                totals.smdToSignUpFollowUp += parseInt(stats.smdToSignUpFollowUp);
                totals.hotFollowUp += parseInt(stats.hotFollowUp);
                totals.ni += parseInt(stats.ni);

                districtRow.innerHTML += `
                    <td>${stats.schools}</td>
                    <td>${stats.pd}</td>
                    <td>${stats.smd}</td>
                    <td>${stats.signed}</td>
                    <td>${stats.smdToSignUpFollowUp}</td>
                    <td>${stats.hotFollowUp}</td>
                    <td>${stats.ni}</td>
                `;

                tbody.appendChild(districtRow);
            });

            const totalRow = document.createElement('tr');
            totalRow.innerHTML = `
                <td>Total</td>
                <td>${totals.schools}</td>
                <td>${totals.pd}</td>
                <td>${totals.smd}</td>
                <td>${totals.signed}</td>
                <td>${totals.smdToSignUpFollowUp}</td>
                <td>${totals.hotFollowUp}</td>
                <td>${totals.ni}</td>
            `;
            tbody.appendChild(totalRow);
        }

        // Function to fetch data from the backend
        function fetchData() {
            fetch('/getReportsByDistrict')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        createTable(data.data);
                    } else {
                        console.error('Error fetching data:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                });
        }

        // Fetch data when the page loads
        window.onload = fetchData;
    </script>
</body>
</html>
